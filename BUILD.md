# Инструкция по сборке SafeKey для Windows

## Подготовка к сборке

### 1. Установка зависимостей

```bash
npm install
```

### 2. Создание иконки

Для Windows установщика требуется файл иконки `build/icon.ico`.

**Вариант 1: Создание через онлайн-сервис**
1. Создайте изображение 256x256 пикселей в формате PNG
2. Конвертируйте в ICO через https://convertio.co/png-ico/
3. Сохраните как `build/icon.ico`

**Вариант 2: Временная заглушка**
Если иконка не создана, electron-builder будет использовать стандартную иконку Electron.

## Сборка приложения

### Разработка

```bash
npm run dev
```

### Сборка для Windows

```bash
# Сборка для всех архитектур (x64 и ia32)
npm run build:win

# Сборка только для x64
npm run build:win64
```

Результат будет в папке `release/`:
- `SafeKey-1.0.0-x64.exe` - установщик для 64-битных систем
- `SafeKey-1.0.0-ia32.exe` - установщик для 32-битных систем

### Установка

1. Запустите установщик `SafeKey-*.exe`
2. Следуйте инструкциям мастера установки
3. Приложение будет установлено в `C:\Program Files\SafeKey\`
4. Ярлык будет создан на рабочем столе и в меню "Пуск"

### Удаление

Через "Параметры Windows" → "Приложения" → найдите SafeKey → "Удалить"

Или используйте "Программы и компоненты" в Панели управления.

## Структура проекта

```
SafeKey/
├── src/
│   ├── main/              # Главный процесс Electron
│   │   ├── config/        # Конфигурация приложения
│   │   ├── database/      # Работа с базой данных
│   │   ├── encryption/    # Шифрование
│   │   ├── types/         # TypeScript типы
│   │   ├── main.ts        # Точка входа
│   │   └── preload.ts     # IPC мост
│   ├── renderer/          # React приложение
│   │   └── src/
│   │       ├── components/
│   │       ├── hooks/
│   │       └── utils/
│   └── shared/            # Общие типы и утилиты
│       └── types/
├── build/                 # Ресурсы для сборки
│   ├── icon.ico          # Иконка приложения (создать!)
│   └── installer.nsh     # Скрипт установщика
└── release/              # Готовая сборка (создается автоматически)
```

## Требования

- Node.js 18+ 
- Windows 10/11 (64-bit или 32-bit)
- Visual Studio Build Tools (для компиляции native модулей)

## Устранение проблем

### Ошибка компиляции better-sqlite3

Установите Visual Studio Build Tools:
1. Скачайте с https://visualstudio.microsoft.com/downloads/
2. Выберите "Build Tools for Visual Studio"
3. Установите компонент "Desktop development with C++"

### Ошибка при сборке electron-builder

Убедитесь, что:
- Все зависимости установлены (`npm install`)
- Иконка существует (`build/icon.ico`)
- Нет ошибок линтера (`npm run lint`)
